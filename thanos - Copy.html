<html>

<head>
    <!--Reference to bootstrap-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"></script>

    <script src="./js/dataLoading.js"></script>

    <meta name="viewport" />
    <style>
        body {
            font-family: Arial;
        }

        /* Style the tab */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        /* Style the buttons inside the tab */
        .tab button {
            background-color: inherit;
            /*float: left;*/
            border: none;
            object-fit: contain;
            outline: none;
            cursor: pointer;
            /*padding: 14px 16px;*/
            transition: 0.3s;
            /*font-size: 17px;*/
        }

        /* POI Header Style */
        .POIHeader {
            text-align: center;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        /* Change background color of buttons on hover */
        .tab button:hover {
            background-color: blue;
        }

        /* Create an active/current tablink class */
        /*.tab button.active {
                background-color: red !important;
            }*/

        /* Style the tab content */
        .tabcontent {
            display: none;
            /*padding: 6px 12px;*/
            -webkit-animation: fadeEffect 1s;
            animation: fadeEffect 1s;
        }

        .nav-tabs {
            display: inline-flex;
        }

        .nav-tabs li {
            /*margin-right: 10px;*/
            list-style-type: none;
        }

        /* Fade in tabs */
        @-webkit-keyframes fadeEffect {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeEffect {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
    <style id="AnimationStyles">
        .parent {
            position: relative;
            display: inline-block;
            top: 0;
            left: 0;
            width: 150px;
            height: 150px;
            background: url('AnimationImages/EnergyBase.jpg') no-repeat;
            background-size: auto 150px;
            overflow: hidden;
            -webkit-transform: rotate(180deg);
            transform: rotate(180deg);
        }

        .child {
            position: relative;
            display: inline-block;
            bottom: 0;
            left: 0;
            width: 150px;
            height: 150px;
            background: url('AnimationImages/EnergyVeryHigh.jpg') no-repeat;
            background-size: auto 150px;
            overflow: hidden;
        }
    </style>
</head>

<body onload="startUP()">
    <!--contains the entire content of each POI-->
    <div class="container" style="position:relative; width: 100%; height: 300px; border: 1px solid black;">
        <!--Contains the tabs at the top of each POI pop-up-->
        <div id="POI_Tabs">
            <div class="row" id="POI_Tabs_topRow">
                <div class="col-xs-4" style="text-align:center; margin: 0%; padding: 0">
                    <button class="tablinks" style="width:100%" onclick="openAttributeTab(event, 'Energy')">Energy</button>
                </div>
                <div class="col-xs-4" style="text-align:center; margin: 0%; padding: 0">
                    <button class="tablinks" style="width:100%" onclick="openAttributeTab(event, 'Gas')">Gas</button>
                </div>
                <div class="col-xs-4" style="text-align:center; margin: 0%; padding: 0">
                    <button class="tablinks" style="width:100%" onclick="openAttributeTab(event, 'CO2')">CO2</button>
                </div>
            </div>
            <div class="row" id="POI_Tabs_bottomRow">
                <div class="col-xs-4" style="text-align:center; margin: 0%; padding: 0">
                    <button class="tablinks" style="width:100%" onclick="openAttributeTab(event, 'Temperature')">Temperature</button>
                </div>
                <div class="col-xs-4" style="text-align:center; margin: 0%; padding: 0">
                    <button class="tablinks" style="width:100%" onclick="openAttributeTab(event, 'Humidity')">Humidity</button>
                </div>
                <div class="col-xs-4" style="text-align:center; margin: 0%; padding: 0">
                    <button class="tablinks" style="width:100%" onclick="openAttributeTab(event, 'Waste')">Waste</button>
                </div>
            </div>
        </div>

        <!--Contains the content for each of the 6 tabs-->
        <div id="POI_Attribute_Content">
            <div id="Energy" class="tabcontent" style="height:185px;">
                <h3 class="POIHeader">Energy</h3>

                <!--Stats Display: CURRENTLY NOT WORKING-->
                <!---->
                <div>
                    <p>Test 1</p>
                    <p>Test 2</p>
                    <p>Test 3</p>
                    <p>Test 4</p>
                </div>
                <!---->

                <!--Animated View-->
                <div id="EnergyBackgroundAnim" class="parent" style="left:200px">
                    <div id="EnergyActiveAnim" class="child"></div>
                </div>

                <!--Contains the tabs at the bottom of each POI Attribute-->
                <div class="row" id="BottomTabs" style="width:100%; position:absolute; bottom:0;">
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="EnergyAnimButton" style="width:100%" onclick="switchBottomTabs(event, 'EnergyGraphButton','EnergyAnimButton')">Animated
                            View
                        </button>
                    </div>
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="EnergyGraphButton" style="width:100%" onclick="switchBottomTabs(event, 'EnergyAnimButton','EnergyGraphButton')">Graph
                            View
                        </button>
                    </div>
                </div>
            </div>

            <div id="Gas" class="tabcontent" style="height:185px">
                <h3 class="POIHeader">Gas</h3>

                <div id="GasBackgroundAnim" class="parent">
                    <div id="GasActiveAnim" class="child"></div>
                </div>

                <!--Contains the tabs at the bottom of each POI Attribute-->
                <div class="row" id="BottomTabs" style="width:100%; position:absolute; bottom:0;">
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="GasAnimButton" style="width:100%" onclick="switchBottomTabs(event, 'GasGraphButton','GasAnimButton')" disabled>Animated
                            View
                        </button>
                    </div>
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="GasGraphButton" style="width:100%" onclick="switchBottomTabs(event, 'GasAnimButton','GasGraphButton')">Graph
                            View
                        </button>
                    </div>
                </div>
            </div>

            <div id="CO2" class="tabcontent" style="height:185px">
                <h3 class="POIHeader">CO2</h3>

                <div id="CO2BackgroundAnim" class="parent">
                    <div id="CO2ActiveAnim" class="child"></div>
                </div>

                <!--Contains the tabs at the bottom of each POI Attribute-->
                <div class="row" id="BottomTabs" style="width:100%; position:absolute; bottom:0;">
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="CO2AnimButton" style="width:100%" onclick="switchBottomTabs(event, 'CO2GraphButton','CO2AnimButton')" disabled>Animated
                            View
                        </button>
                    </div>
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="CO2GraphButton" style="width:100%" onclick="switchBottomTabs(event, 'CO2AnimButton','CO2GraphButton')">Graph
                            View
                        </button>
                    </div>
                </div>
            </div>

            <div id="Temperature" class="tabcontent" style="height:185px">
                <h3 class="POIHeader">Temperature</h3>

                <div id="TemperatureBackgroundAnim" class="parent">
                    <div id="TemperatureActiveAnim" class="child"></div>
                </div>

                <!--Contains the tabs at the bottom of each POI Attribute-->
                <div class="row" id="BottomTabs" style="width:100%; position:absolute; bottom:0;">
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="TemperatureAnimButton" style="width:100%" onclick="switchBottomTabs(event, 'TemperatureGraphButton','TemperatureAnimButton')"
                            disabled>Animated View</button>
                    </div>
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="TemperatureGraphButton" style="width:100%" onclick="switchBottomTabs(event, 'TemperatureAnimButton','TemperatureGraphButton')">Graph
                            View
                        </button>
                    </div>
                </div>
            </div>

            <div id="Humidity" class="tabcontent" style="height:185px">
                <h3 class="POIHeader">Humidity</h3>

                <div id="HumidityBackgroundAnim" class="parent">
                    <div id="HumidityActiveAnim" class="child"></div>
                </div>

                <!--Contains the tabs at the bottom of each POI Attribute-->
                <div class="row" id="BottomTabs" style="width:100%; position:absolute; bottom:0;">
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="HumidityAnimButton" style="width:100%" onclick="switchBottomTabs(event, 'HumidityGraphButton','HumidityAnimButton')"
                            disabled>Animated View</button>
                    </div>
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="HumidityGraphButton" style="width:100%" onclick="switchBottomTabs(event, 'HumidityAnimButton','HumidityGraphButton')">Graph
                            View
                        </button>
                    </div>
                </div>
            </div>

            <div id="Waste" class="tabcontent" style="height:185px">
                <h3 class="POIHeader">Waste</h3>

                <div id="WasteBackgroundAnim" class="parent">
                    <div id="WasteActiveAnim" class="child"></div>
                </div>

                <!--Contains the tabs at the bottom of each POI Attribute-->
                <div class="row" id="BottomTabs" style="width:100%; position:absolute; bottom:0;">
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="WasteAnimButton" style="width:100%" onclick="switchBottomTabs(event, 'WasteGraphButton','WasteAnimButton')" disabled>Animated
                            View
                        </button>
                    </div>
                    <div class="col-xs-6" style="text-align:center; margin: 0%; padding: 0">
                        <button id="WasteGraphButton" style="width:100%" onclick="switchBottomTabs(event, 'WasteAnimButton','WasteGraphButton')">Graph
                            View
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!--Contains the Selectors for time and date-->
        <div id="Selectors" class="row" style="width:100%; padding:0;margin:0;">
            <div class="col-xs-6">
                <select id="TimeSelector" style="width:100%" onchange="timeSelectionChanged()"></select>
            </div>
            <div class="col-xs-6">
                <select id="DateSelector" style="width:100%">
                    <option value="DATE1">Select...</option>
                </select>
            </div>

        </div>
    </div>



    <!--Script below switches tabs-->
    <script>
        //function is called when the webpage is loaded
        function startUP() {
            populateTimeSelector();

            populateDateSelector();

            openAttributeTab(event, 'Energy');

            switchBottomTabs(event, 'EnergyGraphButton', 'EnergyAnimButton');

        }

        //function for top of POI tabs
        function openAttributeTab(myEvent, POIAttributeName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");

                if (tablinks[i].textContent === POIAttributeName) {
                    tablinks[i].style.backgroundColor = "red";
                    tablinks[i].disabled = true;
                }
                else {
                    tablinks[i].style.backgroundColor = "#f1f1f1";
                    tablinks[i].disabled = false;
                }
            }

            document.getElementById(POIAttributeName).style.display = "block";
            myEvent.currentTarget.className += " active";

            var activeGraphButton = POIAttributeName + 'GraphButton';
            var activeAnimButton = POIAttributeName + 'AnimButton';
            switchBottomTabs(event, activeGraphButton, activeAnimButton);

            //Called on a tab switch to load data for the new tab
            timeSelectionChanged();


        }

        //function for bottom of POI tabs
        function switchBottomTabs(myEvent, ButtonToEnable, ButtonToDisable) {

            document.getElementById(ButtonToEnable).disabled = false;
            document.getElementById(ButtonToEnable).style.backgroundColor = "#f1f1f1";
            document.getElementById(ButtonToDisable).style.backgroundColor = "red";
            document.getElementById(ButtonToDisable).disabled = true;
        }

        //populate time selector dropdown
        function populateTimeSelector() {
            var i;
            for (i = 0; i < 24; i++) {
                var timeOptionOnHour = document.createElement("option");
                var timeOptionHalfHour = document.createElement("option");

                var OnHourTimeAsString, halfHourTimeAsString;

                if (i < 10) {
                    OnHourTimeAsString = "0" + i + ":00";
                    halfHourTimeAsString = "0" + i + ":30";
                }
                else {
                    OnHourTimeAsString = i + ":00";
                    halfHourTimeAsString = i + ":30";
                }
                timeOptionOnHour.value = OnHourTimeAsString;
                timeOptionOnHour.innerHTML = OnHourTimeAsString;
                timeOptionHalfHour.value = halfHourTimeAsString;
                timeOptionHalfHour.innerHTML = halfHourTimeAsString;

                TimeSelector.appendChild(timeOptionOnHour);
                TimeSelector.appendChild(timeOptionHalfHour);
            }
        }

        function populateDateSelector() {
            dates = [
                "20-09-2018",
                "21-09-2018",
                "22-09-2018"
            ];
            for (let i = 0; i < 3; i++) {
                let option = document.createElement("option");
                option.value = dates[i];
                option.innerHTML = dates[i];
                DateSelector.appendChild(option);
            }
        }

        // Function to take a parameter from the url
        // https://stackoverflow.com/questions/2405355/how-to-pass-a-parameter-to-a-javascript-through-a-url-and-display-it-on-a-page
        var urlParam = function (name, w) {
            w = w || window;
            var rx = new RegExp('[\&|\?]' + name + '=([^\&\#]+)'),
                val = w.location.search.match(rx);
            return !val ? '' : val[1];
        }

        //get and display selected time on correct tab
        //NOTE: Will be used to select a time and get the data for that time
        function timeSelectionChanged() {
            var activeTimeSelector = document.getElementById("TimeSelector");
            var activeTime = activeTimeSelector.options[activeTimeSelector.selectedIndex].value;
            var allTabs;
            var activeDateSelector = document.getElementById("DateSelector");
            var activeDate = activeDateSelector.options[activeDateSelector.selectedIndex].value;

            //var activeTabPara;

            allTabs = document.getElementsByClassName("tablinks");
            for (i = 0; i < allTabs.length; i++) {
                if (allTabs[i].style.backgroundColor === "red") {
                    let POIAttributeName = allTabs[i].innerHTML;
                    //activeTabPara = document.getElementById(POIAttributeName + "ParaContent");
                    //Time should eventually be used to get data which will be placed in
                    // this function instead of 157, 200 & 100 in order to display it
                    let roomId = urlParam('room');
                    let highest = getHighestValueInRoomWithDate(POIAttributeName, "Room " + roomId, activeDate);
                    let lowest = getLowestValueInRoomWithDate(POIAttributeName, "Room " + roomId, activeDate);
                    let dataAtTime = getDataAtWithDate(POIAttributeName, "Room " + roomId, activeTime, activeDate);
                    console.log(dataAtTime);
                    displayStats2(dataAtTime, highest, lowest, POIAttributeName);
                }
            }
            //activeTabPara.innerHTML = "Current time is " + activeTime;
        }

        //function to show a progress bar which will show the level of a reading,
        //based on its highest and lowest values
        //stat refers to Energy/gas/humidity etc
        //value is its current reading
        function displayStats(statValue, statHighest, statLowest, POIAttributeName) {
            var bar = document.getElementById(POIAttributeName + "Bar");
            var currentWidth = 0;
            var finalWidth = ((statValue - statLowest) / (statHighest - statLowest)) * 100;
            var progressInterval = setInterval(progressbar, 15);

            function progressbar() {

                if (currentWidth >= finalWidth) {
                    clearInterval(progressInterval);
                }
                else {
                    currentWidth++;
                    bar.style.width = currentWidth + '%';
                    bar.innerHTML = currentWidth + '%';
                }

            }
        }

        //ANIMATION DISPLAY - CURRENTLY IN TESTING DO NOT TOUCH
        function displayStats2(statValue, statHighest, statLowest, POIAttributeName) {
            var currentHeight = 0;
            var finalheight = ((statValue - statLowest) / (statHighest - statLowest)) * 150;
            var finalPercentage = (finalheight / 150) * 100;

            //This ensures the user can always see some colour even for low values
            if (finalheight < 7.5) {
                finalheight = 7.5;
            }

            //Sets background Anim Image to the correct image for each tab
            document.getElementById(POIAttributeName + 'BackgroundAnim').style.backgroundImage = "url('AnimationImages/" + POIAttributeName + "Base.jpg')";

            //COLOUR PICKER           
            if (finalPercentage <= 25) {
                document.getElementById(POIAttributeName + 'ActiveAnim').style.backgroundImage = "url('AnimationImages/" + POIAttributeName + "Low.jpg')";
            }
            else if (finalPercentage <= 50) {
                document.getElementById(POIAttributeName + 'ActiveAnim').style.backgroundImage = "url('AnimationImages/" + POIAttributeName + "Medium.jpg')";
            }
            else if (finalPercentage <= 75) {
                document.getElementById(POIAttributeName + 'ActiveAnim').style.backgroundImage = "url('AnimationImages/" + POIAttributeName + "High.jpg')";
            }
            else {
                document.getElementById(POIAttributeName + 'ActiveAnim').style.backgroundImage = "url('AnimationImages/" + POIAttributeName + "VeryHigh.jpg')";
            }

            //Performs Animation
            var update = setInterval(function () {
                currentHeight += 1.5;
                if (currentHeight <= finalheight) {
                    $('.child').css('height', (currentHeight + 'px'));
                }
                else {
                    clearInterval(update);
                }
            }, 10);
        }
    </script>
</body>

</html>